<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>String Interpolation with Templates Using String# &middot; </title>

  
  <link rel="stylesheet" href="http://life.beyondrails.com/css/poole.css">
  <link rel="stylesheet" href="http://life.beyondrails.com/css/hyde.css">
  <link rel="stylesheet" href="http://life.beyondrails.com/css/poole-overrides.css">
  <link rel="stylesheet" href="http://life.beyondrails.com/css/hyde-overrides.css">
  <link rel="stylesheet" href="http://life.beyondrails.com/css/hyde-x.css">
  <link rel="stylesheet" href="http://life.beyondrails.com/css/opalbox.min.css">
  <link rel="stylesheet" href="http://life.beyondrails.com/css/opalbox-dark.min.css">
  <link rel="stylesheet" href="http://life.beyondrails.com/css/styles.css">

  <link rel="stylesheet" href="http://life.beyondrails.com/css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://life.beyondrails.com/touch-icon-144-precomposed.png">
  <link href="http://life.beyondrails.com/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="">
  <meta name="keywords" content="">
  

  <script type="text/javascript" src="http://cdn.opalrb.org/opal/0.7.1/opal.min.js"></script>
  <script type="text/javascript" src="http://cdn.opalrb.org/opal/0.7.1/opal-parser.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <script type="text/javascript" src="http://life.beyondrails.com/js/opalbox-jquery.min.js"></script>

</head>
<body class="theme-base-0b">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1></h1>
      <p class="lead">Codesmithing by day. Airsculpting by night.</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://life.beyondrails.com/">Blog Index</a></li>
      
      <li class="sidebar-nav-item"><a href="http://life.beyondrails.com/about/">About Me</a></li>
      
      <li class="sidebar-nav-item"><a href="http://life.beyondrails.com/zen/">Zen</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/parasquid"><i class="fa fa-github-square fa-3x"></i></a>
      
      
      <a href="https://www.linkedin.com/in/parasquid"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="https://plus.google.com/u/1/&#43;TristanGomez/posts"><i class="fa fa-google-plus-square fa-3x"></i></a>
      <a href="https://www.facebook.com/parasquid"><i class="fa fa-facebook-square fa-3x"></i></a>
      <a href="https://twitter.com/parasquid"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      
      </li>
    </ul>

    

    <p>Copyright &copy; 2017 <a href="http://life.beyondrails.com/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">String Interpolation with Templates Using String#</h1>
    <span class="post-date">Feb 5, 2016 &middot; 3 minute read &middot; <a href="http://life.beyondrails.com/blog/2016/02/05/string-interpolation-with-templates-using-string/#disqus_thread">Comments</a>
    
    <br/>
    <a class="label" href="http://life.beyondrails.com/categories/til">til</a>
    </span>
    <p>I was working on a feature for <a href="https://github.com/parasquid/upcloudify">upcloudify</a> that will use Slack notifications instead of email notifications. One of the challenges I faced was how to build-in flexibility for generating messages. I would want that the user be able to provide their own custom notification message, but at the same time be able to provide placeholders for items like the S3 download link.

<script>
$(function() {
    $('.ruby-code').opalBox();
  var $targets = $(".ruby-code textarea")
  $targets.each(function() {
    $(this).height(0).height(this.scrollHeight - $(this).css("font-size").replace('px','')).change();
  })
});
</script>
</p>

<p>I initially thought of using an <code>ERB</code> template but then realized it will be far too overkill for this simple purpose. I actually just needed to have the caller be able to provide a template string, and then merge certain variables into this template string.</p>

<p>I started playing around with regexes when I came upon <a href="http://ruby-doc.org/core-2.2.0/String.html#method-i-25">String#%</a></p>

<p>From the documentation:</p>

<blockquote>
<p>Formatâ€”Uses <em>str</em> as a format specification, and returns the result of applying it to <em>arg</em>. If the format specification contains more than one substitution, then <em>arg</em> must be an <code>Array</code> or <code>Hash</code> containing the values to be substituted. See <code>Kernel::sprintf</code> for details of the format string.</p>
</blockquote>

<pre><code class="language-ruby">&quot;%05d&quot; % 123                              #=&gt; &quot;00123&quot;
&quot;%-5s: %08x&quot; % [ &quot;ID&quot;, self.object_id ]   #=&gt; &quot;ID   : 200e14d6&quot;
&quot;foo = %{foo}&quot; % { :foo =&gt; 'bar' }        #=&gt; &quot;foo = bar&quot;
</code></pre>

<p>I thought this was very cool. Let me show you what I mean:</p>

<div class="ruby-code">
template = "Hello %s!"

puts template % "World"
</div>

<p>You can also use an array to feed the template:</p>

<div class="ruby-code">
template = "Because Oct %o = Dec %d"

puts "Why do programmers always mix up Halloween and Christmas?"
puts template % [25, 25]
</div>

<p>For an even better template that doesn&rsquo;t depend on the order of the elements, you can feed in a <code>Hash</code>:
<div class="ruby-code">
template = "
Q: What's the %{programming_paradigm} way to become wealthy?
A: %{answer}"

puts template % {programming_paradigm: "Object Oriented", answer: "Inheritance"}
</div></p>

<p><strong>Note:</strong> Sadly, OpalBox doesn&rsquo;t seem to work well with this particular usage of <code>String#%</code> since <a href="https://github.com/opal/opal/issues/678">Opal 0.7.1 has a bug</a> where it doesn&rsquo;t properly interpolate named parameters (I&rsquo;ve already <a href="https://github.com/Angelmmiguel/opalbox-jquery/issues/3">reported this</a> to the opalbox author). I will update this article whenever the issues have been ironed out.</p>

<p>Runnning the code in <code>IRB</code> works however:</p>

<pre><code>puts template % {programming_paradigm: &quot;Object Oriented&quot;, answer: &quot;Inheritance&quot;}
Q: What's the Object Oriented way to become wealthy?
A: Inheritance
</code></pre>

<p>The method is also written in C (at least for MRI) so it&rsquo;s expected to be fast.</p>

<pre><code>puts Benchmark.measure { &quot;Hello %s&quot; % &quot;World&quot; * 6_000_000}
  0.010000   0.040000   0.050000 (  0.051013)
</code></pre>

<p>In the end the code for the feature I was working on looked like this:</p>

<pre><code class="language-ruby"># gem source
def upload_and_notify(filename: nil, attachment: nil, message: &quot;%s&quot;)
  raise ArgumentError &quot;filename cannot be nil&quot; unless filename
  raise ArgumentError &quot;attachment cannot be nil&quot; unless attachment

  expiration = (Date.today + 7).to_time
  file = @uploader.upload(filename, attachment)
  @notifier.notify(text: message % file.url(expiration))
end

# spec file
context &quot;the notification can merge the file url&quot; do
  When { expect(notifier).to receive(:notify).with({text: &quot;your report &lt;filename link&gt;&quot;}) }
  Then {
    expect {
      instance.upload_and_notify(filename: 'abc', attachment: '123', message: &quot;your report &lt;%s&gt;&quot;)
    }.not_to raise_error
  }
end
</code></pre>

<h2 id="see-also">See also:</h2>

<ul>
<li><a href="http://ruby-doc.org/core-2.2.0/String.html#method-i-25">http://ruby-doc.org/core-2.2.0/String.html#method-i-25</a></li>
<li><a href="http://ruby-doc.org/core-2.2.0/Kernel.html#method-i-sprintf">http://ruby-doc.org/core-2.2.0/Kernel.html#method-i-sprintf</a></li>
<li><a href="http://blog.revathskumar.com/2013/01/ruby-multiple-string-substitution-in-string-template.html">http://blog.revathskumar.com/2013/01/ruby-multiple-string-substitution-in-string-template.html</a></li>
<li><a href="http://davebaker.me/articles/tip-ruby-string-interpolation-with-hashes">http://davebaker.me/articles/tip-ruby-string-interpolation-with-hashes</a></li>
</ul>

<h2 id="tldr">TLDR;</h2>

<p><code>String#%</code> is a cool and flexible way to store a template in a string so you can defer the string interpolation.</p>
  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "parasquid";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "parasquid";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="http://life.beyondrails.com/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

